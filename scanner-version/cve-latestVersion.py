import requests
from prometheus_client import start_http_server, Gauge

# Create a Prometheus metric to store the latest version (as a float)
latest_version_metric = Gauge("cvedb_latest_version", "Latest version from GitHub")

def fetch_latest_version():
    repo_url = "https://raw.githubusercontent.com/neuvector/manifests/main/versions/scanner"  # Replace with your GitHub repository URL
    response = requests.get(repo_url)
    if response.status_code == 200:
        latest_version = response.text.strip()
        try:
            latest_version = float(latest_version)  # Convert to a float
        except ValueError:
            latest_version = -1.0  # Set to a default value or handle the error as needed
        return latest_version
    else:
        return -1.0  # Set to a default value if the request fails

if __name__ == "__main__":
    start_http_server(8082)  # Start an HTTP server on port 8080
    while True:
        latest_version = fetch_latest_version()
        latest_version_metric.set(latest_version)

